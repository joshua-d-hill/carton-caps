openapi: 3.0.3
info:
  title: Carton Caps Referral API
  description: |
      # Introduction
      This API allows Carton Caps users to refer friends to install the CC app on their mobile device, and utilizes deferred deep links to customize the installation experience for the referred user.

      # OpenAPI Specification
      This API is documented in **OpenAPI format** and is based on the
      [Petstore sample](https://petstore.swagger.io/) provided by the [swagger.io](https://swagger.io) team.
      
      # Documentation
      Full API documentation can be referenced [here](https://editor.swagger.io/?url=https://raw.githubusercontent.com/joshua-d-hill/cartoncaps/master/openapi.yaml)
  
      # Installation and testing
      Testing servers stubs and client SDKs have been generated using [Swagger Codegen](https://swagger.io/docs/open-source-tools/swagger-codegen/)
      
      # Skills Challenge Questions
      Q: How will existing users create new referrals using their existing referral code?
      A: The CC app would POST to the /referrals endpoint with data matching the referral schema (see below).
      
      Q: How will the app generate referral links for the share feature?
      A: The app would make a request to the third-party vendor for deferred deep link support.  This link would be included in the POST to the /referrals endpoint.
      
      Q: How will existing users check the status of their referrals?
      A: The app would make a GET request to the /referrals endpoint with a filter on the user's referrer ID.
      
      Q: How will the app know where to direct new users after they install the app via a referral?
      A: The deferred deep link provided by the third-party vendor would direct new users to the "You've Been Invited" gate page after they have installed the Carton Caps application.
      
      Q: Since users may eventually earn rewards for referrals, should we take extra steps to mitigate abuse?
      A: This might be addressed in three ways, depending on client preference and in escalating severity: 
      - generate a new referral code (for example, if a user posted their code on a discount-sharing website)
      - disable the "share" feature for the offending user
      - disable the app credentials for the offending user
      
  termsOfService: https://livefront.com/terms/
  contact:
    name: Joshua Hill
    url: https://github.com/joshua-d-hill/carton-caps-referral-api/
    email: joshua.d.hill@gmail.com
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html
  version: 1.0.0
servers:
  - url: http://localhost:8080
    description: Mock web service for API testing

paths:
  /referrals:
    get:
      operationId: getReferrals
      description: List all referrals
      parameters:
        - name: limit
          in: query
          description: Limits the number of referrals per page
          schema:
            type: integer
        - name: offset
          in: query
          description: Specify the page number of the referral to be displayed
          schema:
            type: integer
      tags:
        - referrals
      responses:
        '200':
          description: OK - Successfully fetched referrals
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/referral'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
    post: 
      operationId: createReferral
      description: Generate a new referral
      tags:
        - referrals
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/referral'
      responses:
        '201':
          description: OK - New referral created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/referral'
          
  /referrals/{referralId}:
    get:
      operationId: getReferral
      description: Fetch a referral by id including its referee, status, link, and method
      tags:
      - referral
      parameters:
      - name: referralId
        in: path
        description: ID of a referral to return
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          description: Referral retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/referral'
        '400':
          description: Invalid referral ID
    post:
      tags: 
      - referral
      description: Updates a referral in system
      operationId: updateReferral
      parameters:
        - name: referralId
          in: path
          description: ID of referral to update
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '400':
          description: Invalid referral ID
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  description: Updated status of the referral
                  type: string
    delete:
      tags:
        - referral
      description: Deletes a referral from the system
      operationId: deleteReferral
      parameters:
        - name: referralId
          in: path
          description:  ID of referral to delete
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '400':
          description: Invalid referral ID
        
components:
  securitySchemes:
    BasicAuth:
      type: http
      scheme: basic
  schemas:
    referral:
      type: object
      properties:
        id:
          type: string
          description: id
          example: '123'
        referee:
          type: string
          description: ID of referred user
          example: '123'
        referer:
          type: string
          description: ID of referring user
          example: '123'
        code:
          type: string
          description: six-character referral code
          example: 'XFCDOB'
        status:
          type: string
          description: Status of referral - Sent, Received, Complete
          example: 'Complete'
        link:
          type: string
          description: The deferred deep link used by the referee to install the app and view the 'You've Been Invited' gate screen
          example: 'https://cartoncaps.link/abfilefa90p?referral_code=referral_code'
        method: 
          type: string
          description: Method used to create referral - text, email, share
          example: 'text'
security:
  - BasicAuth: []
tags:
  - name: referral
    description: Update or delete a single referral; requires referral ID.
  - name: referrals
    description: Fetch all referrals in system or create a new one.
externalDocs:
  description: Code and additional information about this API
  url: https://github.com/joshua-d-hill/carton-caps-referral-api/
